<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" id="event-page" class="loading finans-bank-forum-2 status-archive">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<link rel="stylesheet" href="tests.css" type="text/css"/>
	<title>EventTarget tests</title>
</head>
<body>

<!--[if lte IE 7]><script type="text/javascript" src="../programica/fixes/trident3.js"></script><![endif]-->
<!--[if IE 8]><script type="text/javascript" src="../programica/trident4.js"></script><![endif]-->
<script type="text/javascript" src="../programica/fixes/log.js"></script>
<script type="text/javascript" src="../programica/init.js"></script>
<script type="text/javascript" src="../programica/class.js"></script>
<script type="text/javascript" src="../modules/event-target.js"></script>

<script type="text/javascript" src="tests.js"></script>
<script type="text/javascript">
	window.addEventListener('load', function () {
	tests.plan(21)
	tests.skip([3,4,5,6,12])
	
	var node = document.body, type = 'hide', calls = 0, exception = null
	function handler (e) { calls++ }
	
	try {
	
	tests.log('testing event base classes')
	tests.eq(typeof EventTarget, 'object', 'EventTarget is an object')
	// tests.eq(typeof EventException, 'object', 'EventException is an object')
	tests.ne(self.Event, undefined, 'Event defined')
	tests.ne(self.DocumentEvent, undefined, 'DocumentEvent defined')
	tests.ne(self.UIEvent, undefined, 'UIEvent defined')
	tests.ne(self.MouseEvent, undefined, 'MouseEvent defined')
	tests.ne(self.KeyEvent, undefined, 'KeyEvent defined')
	tests.ne(self.MutationEvent, undefined, 'MutationEvent defined')
	
	tests.log('testing public interface')
	tests.eq(typeof node.addEventListener, 'function', 'node.addEventListener is a function')
	node.addEventListener(type, handler,false)
	tests.eq(calls, 0, 'addEventListener does not call handler')
	
	tests.eq(typeof document.createEvent, 'function', 'document.createEvent is a function')
	var e = document.createEvent('UIEvent')
	tests.eq(typeof e, 'object', 'document.createEvent returns an object')
	tests.eq(e.constructor, self.UIEvent, 'document.createEvent(UIEvent).constructor == UIEvent')
	e.abcdef = 'abcdef'
	tests.eq(e.abcdef, 'abcdef', 'event object supports custom fields')
	
	tests.eq(typeof e.initEvent, 'function', 'event.initEvent is a function')
	e.initEvent(type, true, true)
	tests.eq(e.type, type, 'event.initEvent sets event type correctly')
	
	tests.eq(typeof node.dispatchEvent, 'function', 'node.dispatchEvent is a function')
	node.dispatchEvent(e)
	tests.eq(calls, 1, 'dispatchEvent does call handler')
	e.initEvent(type, true, true)
	node.dispatchEvent(e)
	tests.eq(calls, 2, 'custom handler called ok twice')
	
	node.removeEventListener(type, handler, false)
	// e = document.createEvent('UIEvent')
	e.initEvent(type, true, true)
	node.dispatchEvent(e)
	tests.eq(calls, 2, 'removeEventListener works fine')
	
	node.addEventListener(type, handler, false)
	node.addEventListener(type, handler, false)
	e.initEvent(type, true, true)
	node.dispatchEvent(e)
	tests.eq(calls, 3, 'second addEventListener ignored')
	
	
	} catch (ex) { exception = ex }
	tests.eq(exception, null, 'no exceptions was throwed')
	
	tests.done()
	}, false)
</script>
</body>
</html>
