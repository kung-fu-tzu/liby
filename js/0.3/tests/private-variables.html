<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru" id="event-page" class="loading finans-bank-forum-2 status-archive">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<link rel="stylesheet" href="tests.css" type="text/css"/>
	<title>Event classes tests</title>
</head>
<body>

<!--[if lte IE 7]><script type="text/javascript" src="../programica/fixes/trident3.js"></script><![endif]-->
<!--[if IE 8]><script type="text/javascript" src="../programica/fixes/trident4.js"></script><![endif]-->
<script type="text/javascript" src="../programica/fixes/log.js"></script>
<script type="text/javascript" src="../programica/init.js"></script>

<script type="text/javascript" src="tests.js"></script>
<script type="text/javascript">
	window.addEventListener('load', function () {
	tests.plan(6)
	
	
	// first, the A
	function A ()
	{
		// private variable priv
		var priv
		this.setPriv = function (val) { return priv = val }
		this.getPriv = function () { return priv }
	}
	
	// instantiating
	var a1 = new A()
	var a2 = new A()
	
	// setting
	a1.setPriv('from a1')
	a2.setPriv('from a2')
	
	// getting: all works well
	tests.eq(a1.getPriv(), 'from a1', 'direct var 1')
	tests.eq(a2.getPriv(), 'from a2', 'direct var 2')
	
	
	// then a subclass had been exists
	function B () { }
	B.prototype = new A('from B')
	
	// instantiating
	var b1 = new B()
	var b2 = new B()
	
	// setting
	b1.setPriv('from b1')
	b2.setPriv('from b2')
	
	// getting: error b1 and b2 shares the same private variable priv from the B.prototype
	tests.eq(b1.getPriv(), 'from b2', 'subclass var 1 = var 2')
	tests.eq(b2.getPriv(), 'from b2', 'subclass var 2')
	
	
	// all work will be perform in constructor,
	// so we can't avoid an unnecessary calculations
	function C ()
	{
		var variable1 = 123
		this.method1 = function () { variable1 += 1 }
		this.method2 = function () { variable1 += 2 }
		this.method3 = function () { variable1 += 3 }
		this.method4 = function () { variable1 += 4 }
		this.method5 = function () { variable1 += 5 }
		this.method6 = function () { variable1 += 6 }
		this.method7 = function () { variable1 += 7 }
		this.method8 = function () { variable1 += 8 }
	}

	// nithing will be done in constructor,
	// this gives us a chance to gain a performance boost
	function D () {}
	D.prototype =
	{
		variable1: 123,
		method1: function () { this.variable1 += 1 },
		method2: function () { this.variable1 += 2 },
		method3: function () { this.variable1 += 3 },
		method4: function () { this.variable1 += 4 },
		method5: function () { this.variable1 += 5 },
		method6: function () { this.variable1 += 6 },
		method7: function () { this.variable1 += 7 },
		method8: function () { this.variable1 += 8 }
	}
	
	tests.time('C')
	for (var i = 0; i < 10000; i++)
		var c = new C()
	var ctime = tests.timeEnd('C')
	
	tests.time('D')
	for (var i = 0; i < 10000; i++)
		var d = new D()
	var dtime = tests.timeEnd('D')
	
	tests.ok(ctime > dtime * 5, 'new C >> new D')
	
	
	var c = new C()
	tests.time('C')
	for (var i = 0; i < 1000000; i++)
		c.method8()
	var ctime = tests.timeEnd('C')
	
	var d = new D()
	tests.time('D')
	for (var i = 0; i < 1000000; i++)
		d.method8()
	var dtime = tests.timeEnd('D')
	
	tests.ok((ctime + 1) / (dtime + 1) < 2, 'C#method8() ~= D#method8()')
	
	tests.done()
	}, false)
</script>
</body>
</html>
