<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Капнем капельку физики</title>
	<script type="text/javascript" src="/lib/Programica.js"></script>
	<style>
		canvas { border: 1px solid #eee; display: block; cursor: default;/*width: 500px; height: 150px;*/ }
		/*canvas { -webkit-transform: rotate(3deg); cursor: pointer; }*/
	</style>
</head>
<body>
	<canvas id="viewport" width="1000" height="300"></canvas>
	
	<script>
	
	var can = $('viewport')
	var ctx = can.getContext('2d')
	
	var shapes =
	[
		{x: 460, y: 150, fill: 'rgb(255, 128, 0)', vx: 0, vy: 0, m: 500, rot: 0, points: [-10,-10,10,-10,10,10,-10,10]}
	]
	
	for (var i = 1; i < 500; i++)
		shapes.push({x: i*2, y: 150 + 10 * Math.sin(i), fill: 'rgb(255, 220, 153)', vx: 0, vy: 0, m: 1, rot: 0, points: [-10,-10,10,-10,10,10,-10,10]})
	
	ctx.strokeStyle = 'rgb(0, 0, 0)'
	
	function compute ()
	{
		var shape, points, a, b, dx, dy, c, f, kx, ky
		for (var i = 0, il = shapes.length; i < il; i++)
		{
			a = shapes[i]
			
			
			//for (var j = i+1; j < il; j++)
			//{
				b = shapes[0]
				
				dx = b.x - a.x
				dy = b.y - a.y
				//if (dx > 100 || dy > 100)
				//	continue
				
				c = Math.sqrt(dx * dx + dy * dy) + 300
				
				f = 1000 * (a.m * b.m) / (c * c)
				//f = -f
				
				kx = dx / c
				ky = dy / c
				
				a.vx += f * kx / a.m
				a.vy += f * ky / a.m
				b.vx += -f * kx / b.m
				b.vy += -f * ky / b.m
				
			//}
		}
	}
	
	function move ()
	{
		for (var i = 0, il = shapes.length; i < il; i++)
		{
			a = shapes[i]
			
			var nx = a.x + a.vx
			var ny = a.y + a.vy
			
			
			if (nx < 0)
			{
				nx = -nx
				a.vx = -a.vx
			}
			else if (nx > 1000)
			{
				nx = 2000 - nx
				a.vx = -a.vx
			}
			
			if (ny < 0)
			{
				ny = -ny
				a.vy = -a.vy
			}
			else if (ny > 300)
			{
				ny = 600 - ny
				a.vy = -a.vy
			}
			
			a.x = nx
			a.y = ny
		}
	}
	
	function draw ()
	{
		ctx.fillStyle = 'rgb(0,0,0)'
		ctx.fillRect(0, 0, 1000, 300)
		
		var a, points
		for (var i = 0, il = shapes.length; i < il; i++)
		{
			a = shapes[i]
			
			ctx.save()
			ctx.translate(a.x, a.y)
			ctx.rotate(a.rot)
			ctx.fillStyle = a.fill
			ctx.globalAlpha = 1/(Math.sqrt(a.vx * a.vx + a.vy * a.vy)+1)
			ctx.beginPath()
			/*points = a.points
			ctx.moveTo(points[0], points[1])
			for (var j = 2, jl = a.points.length; j < jl; j+=2)
			{
				ctx.lineTo(points[j], points[j+1])
			}
			ctx.lineTo(points[0], points[1])*/
			//
			ctx.arc(0, 0, Math.pow(a.m, 1/3)/(Math.sqrt(a.vx * a.vx + a.vy * a.vy)+1)*2, 0, Math.PI * 2, false)
			ctx.fill()
			ctx.restore()
		}
		
		//shapes[1].rot += 0.1
	}
	
	function loaded ()
	{
		
		setInterval(compute, 50)
		compute()
		setInterval(move, 20)
		setInterval(draw, 20)
	}
	
	$.onload(loaded)
	</script>
	
</body>
</html>