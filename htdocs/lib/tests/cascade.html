<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=320"/>
	<title>Cascade tests</title>
	
	<script src="tests.common.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
Tests.test(function (t)
{
	t.test('parallel(true)', function (t)
	{
		var order = []
		
		var c = new Cascade(function () { order.push('job') })
		
		c.add(new Cascade(function () { order.push('delayed') })).run(100)
		c.add(new Cascade(function () { order.push(1) })).run()
		c.add(new Cascade(function () { order.push(2) })).run()
		c.add(function () { order.push(3) }).run()
		c.oncomplete = function ()
		{
			t.eqo(order, [1, 2, 3, 'delayed', 'job'], 'order')
			t.done()
		}
		c.run(200)
		t.wait(1000)
	})
	
	t.test('parallel(false)', function (t)
	{
		var order = []
		
		var c = new Cascade(function () { order.push('job') })
		c.parallel = false
		c.add(new Cascade(function () { order.push('delayed') }, 250))
		c.add(new Cascade(function () { order.push(1) }))
		c.add(new Cascade(function () { order.push(2) }))
		c.add(function () { order.push(3) })
		c.oncomplete = function ()
		{
			t.eqo(order, ['job', 'delayed', 1, 2, 3])
			t.done()
		}
		t.wait(1000)
	})
	
	t.test('cascade', function (t)
	{
		var order = []
		
		var c = new Cascade(function (c)
		{
			order.push(0)
			
			c.add(function (c)
			{
				order.push(0.1)
				c.add(function (c) { order.push(1) })
				c.add(function (c) { order.push(2) })
			})
			
			c.add(function (c)
			{
				order.push(0.2)
				c.add(function (c) { order.push(3) })
				c.add(function (c) { order.push(4) })
				c.add(function (c) { order.push(5) })
			})
		})
		
		c.oncomplete = function ()
		{
			t.eqo(order, [0, 0.1, 0.2, 1, 2, 3, 4, 5])
			t.done()
		}
		t.wait(1000)
	})
	
	t.test('stop', function (t)
	{
		var order = []
		
		var c = new Cascade(function (c)
		{
			order.push(0)
			
			c.add(function (c)
			{
				order.push(0.1)
				c.add(function (c) { order.push(1) })
				c.add(function (c) { order.push(2); c.add(function (c) { order.push(2.2) }) })
				c.stop()
				c.add(function (c) { order.push(2.1) })
			})
			
			c.add(function (c)
			{
				order.push(0.2)
				c.add(function (c) { order.push(3) })
				c.add(function (c) { order.push(4) })
				c.add(function (c) { order.push(5) })
			})
		})
		
		c.oncomplete = function ()
		{
			t.eqo(order, [0, 0.1, 0.2, 3, 4, 5])
			t.done()
		}
		t.wait(1000)
	})
})
</script>
</body>
</html>