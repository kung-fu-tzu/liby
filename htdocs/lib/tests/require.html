<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=320"/>
	<title>Tests for require()</title>
	
	<script src="tests.common.js" type="text/javascript"></script>
	
	<!--[if lte IE 7]><script type="text/javascript" src="../core/fixes/trident3.js"></script><![endif]-->
	<!--[if gte IE 8]><script type="text/javascript" src="../core/fixes/trident4.js"></script><![endif]-->
	<script type="text/javascript" src="../modules/require.js"></script>
</head>
<body>
<script type="text/javascript">
Tests.test(function (t)
{
	t.test('script onload', function (t)
	{
		t.expect(1)
		var script = document.getElementsByTagName('head')[0].appendChild(document.createElement('script'))
		script.addEventListener('load', onload, false)
		script.src = 'require-file-1.js?ac=' + Math.random()
		t.time('load')
		function onload (e)
		{
			t.timeEnd('load')
			t.ok(window.veryGlobalVaiable, 'global variable set')
			t.done()
		}
		
		t.wait(10000)
	})
	
	t.test('require()', function (t)
	{
		t.parallel(1)
		
		window.veryGlobalCounter = 0
		
		function test (t, count)
		{
			t.expect(1)
			
			function onload (e)
			{
				t.eq(window.veryGlobalCounter, count)
				t.done()
			}
			
			require('require-file-2.js', onload)
			
			t.wait(10000)
		}
		
		t.test('fist', function (t)
		{
			test(t, 1)
		})
		
		t.test('second', function (t)
		{
			test(t, 2)
		})
		
		t.test('third', function (t)
		{
			test(t, 3)
		})
	})
	
})
</script>
</body>
</html>