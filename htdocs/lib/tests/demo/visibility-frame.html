<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=320"/>
	<title>Visibility frame tests</title>
	
	
	<!--[if lte IE 7]><script type="text/javascript" src="../../core/fixes/trident3.js"></script><![endif]-->
	<!--[if gte IE 8]><script type="text/javascript" src="../../core/fixes/trident4.js"></script><![endif]-->
	<script src="../../core/prototype.js" type="text/javascript"></script>
	<script src="../../modules/log.js" type="text/javascript"></script>
	<script src="../../modules/cosy.js" type="text/javascript"></script>
	
	<script src="../../modules/gridder.js" type="text/javascript"></script>
	<script src="../../modules/visibility-frame.js" type="text/javascript"></script>
	<script src="../../modules/event-driven.js" type="text/javascript"></script>
	<script src="../../modules/moveable.js" type="text/javascript"></script>
	
	<style type="text/css">
		html, body { margin: 0; padding: 0; }
		#boxes { position: absolute; left: 0; top: 0; width: 100%; height: 100%; overflow: hidden; }
		#boxes .box { position: absolute; z-index: 1; left: 0; top: 0; background-color: #888; opacity: 0.25; }
		
		#frame { position: absolute; z-index: 2; left: 0; top: 0; width: 400px; height: 300px; background-color: #fff; border: 1px solid #888; }
	</style>
</head>
<body id="boxes">
<div id="frame"></div>
<script type="text/javascript">
$.onload(function ()
{
	var boxesRoot = $('boxes')
	
	var boxes = []
	
	var rw = boxesRoot.offsetWidth, rh = boxesRoot.offsetHeight,
		mw = rw / 5, mh = rh / 5, min = 25,
		random = Math.random
	for (var i = 0; i < 0; i++)
	{
		var w = (random() * mw + min) >> 0,
			h = (random() * mh + min) >> 0,
			x = (random() * (rw - w)) >> 0,
			y = (random() * (rh - h)) >> 0
		
		var box = boxes[i] = document.createElement('div')
		box.className = 'box'
		var s = box.style
		s.left = x + 'px'
		s.top = y + 'px'
		s.width = w + 'px'
		s.height = h + 'px'
		
		boxesRoot.appendChild(box)
	}
	
	var frameNode = $('frame')
	
	var frame = new VisibilityFrame()
	// frame.setNodes(boxes)
	
	var m = new Moveable()
	m.bind(frameNode)
	
	var x = 0, y = 0
	m.addEventListener('movestart', function (e) { x = frameNode.offsetLeft, y = frameNode.offsetTop }, false)
	m.addEventListener('move', function (e) { frameNode.style.left = x + e.data.dx + 'px', frameNode.style.top = y + e.data.dy + 'px' }, false)
	
})
</script>
</body>
</html>