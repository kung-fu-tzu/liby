<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width"/>
	<title>Built-in event propagation tests</title>
	<script src="tests.common.js" type="text/javascript"></script>
	
	<!--[if lte IE 7]><script type="text/javascript" src="../core/fixes/trident3.js"></script><![endif]-->
	<!--[if gte IE 8]><script type="text/javascript" src="../core/fixes/trident4.js"></script><![endif]-->
</head>
<body>

<form id="node-1"><input type="submit"/></form>
<script id="node-2"></script>
<input id="node-3"/>
<input id="node-4"/>

<script type="text/javascript">
Tests.test(function (t)
{
	function $ (id) { return document.getElementById(id) }
	
	t.test('submit on form', function (t)
	{
		var node = $('node-1')
		
		var fired = false
		node.onsubmit = function (e) { fired = true; if (e) { e.preventDefault() } else {return false} }
		
		var order = []
		function captures () { order.push('captures') }
		function bubbles () { order.push('bubbles') }
		document.addEventListener('submit', captures, true)
		document.addEventListener('submit', bubbles, false)
		
		var button = node.firstChild
		try
		{
			button.click()
		}
		catch (ex)
		{
			var e = document.createEvent('MouseEvent')
			e.initEvent('click', true, true)
			button.dispatchEvent(e)
		}
		
		
		t.like(order, ['captures', 'bubbles'], '“submit” captures and bubbles')
		t.eq(fired, true, '“submit” was fired on the node itself')
	})
	
	t.test('load on script', function (t)
	{
		var node = $('node-2')
		
		var order = []
		function captures () { order.push('captures') }
		function bubbles () { order.push('bubbles') }
		document.addEventListener('load', captures, true)
		document.addEventListener('load', bubbles, false)
		
		var fired = false
		function check ()
		{
			t.like(order, ['captures'], '“load” captures only')
			t.eq(fired, true, '“load” was fired on the node itself')
			
			t.done()
		}
		
		function fire () { fired = true; setTimeout(check, 10) }
		if (node.attachEvent)
			node.attachEvent('onreadystatechange', function () { if (node.readyState == 'loaded') fire() })
		else
			node.onload = fire
		
		node.src = 'require-file-1.js'
		
		t.wait(1000)
	})
	
	t.test('keydown on input', function (t)
	{
		var node = $('node-3')
		
		var order = []
		function captures () { order.push('captures') }
		function bubbles () { order.push('bubbles') }
		document.addEventListener('keydown', captures, true)
		document.addEventListener('keydown', bubbles, false)
		
		var fired = false
		function fire () { fired = true }
		node.onkeydown = fire
		
		try
		{
			node.fireEvent('onkeydown')
		}
		catch (ex)
		{
			var e = document.createEvent('UIEvent')
			e.initEvent('keydown', true, true)
			node.dispatchEvent(e)
		}
		
		t.like(order, ['captures', 'bubbles'], '“keydown” captures and bubbles')
		t.eq(fired, true, '“keydown” was fired on the node itself')
	})
	
	t.test('focus on input', function (t)
	{
		var node = $('node-4')
		
		var order = []
		function captures () { order.push('captures') }
		function bubbles () { order.push('bubbles') }
		document.addEventListener('focus', captures, true)
		document.addEventListener('focus', bubbles, false)
		
		var fired = false
		function fire () { fired = true }
		node.onfocus = fire
		
		node.focus()
		
		t.like(order, ['captures'], '“focus” captures only')
		t.eq(fired, true, '“focus” was fired on the node itself')
	})
})
</script>
</body>
</html>