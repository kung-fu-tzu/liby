<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width"/>
	<title>Built-in event propagation tests</title>
	<script src="tests.common.js" type="text/javascript"></script>
	
	<!--[if lte IE 7]><script type="text/javascript" src="../core/fixes/trident3.js"></script><![endif]-->
	<!--[if gte IE 8]><script type="text/javascript" src="../core/fixes/trident4.js"></script><![endif]-->
</head>
<body>
<script type="text/javascript">
Tests.test(function (t)
{
	t.test('submit on form', function (t)
	{
		var node = document.createElement('form')
		document.body.appendChild(node)
		
		var submitted = false
		node.onsubmit = function (e) { submitted = true; if (e) { e.preventDefault() } else {return false} }
		
		var calls = 0
		function handler () { calls++ }
		document.addEventListener('submit', handler, true)
		document.addEventListener('submit', handler, false)
		
		node.innerHTML = '<input type="submit"/>'
		var button = node.firstChild
		try
		{
			button.click()
		}
		catch (ex)
		{
			var e = document.createEvent('MouseEvent')
			e.initEvent('click', true, true)
			button.dispatchEvent(e)
		}
		
		
		t.eq(calls, 2, '“submit” captures and bubbles')
		t.eq(submitted, true, 'an attemp to submit has took place')
	})
	
	t.test('load on script', function (t)
	{
		var node = document.createElement('script')
		document.body.appendChild(node)
		
		var calls = 0
		function handler () { calls++ }
		document.addEventListener('load', handler, true)
		document.addEventListener('load', handler, false)
		
		var loaded = false
		function check ()
		{
			t.eq(calls, 1, '“load” captures only')
			t.eq(loaded, true, 'load was fired on the node itself')
			
			t.done()
		}
		
		function onload () { loaded = true; setTimeout(check, 10) }
		if (node.attachEvent)
			node.attachEvent('onreadystatechange', function () { if (node.readyState == 'loaded') onload() })
		else
			node.onload = onload
		
		node.src = 'require-file-1.js'
		
		t.wait(1000)
	})
})
</script>
</body>
</html>