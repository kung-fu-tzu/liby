<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=320"/>
	<title>Oops tests</title>
	
	<script src="tests.common.js" type="text/javascript"></script>
	
	<script type="text/javascript" src="../modules/oops.js"></script>
</head>
<body>
<script type="text/javascript">
Tests.test(function (t)
{
	var reports = []
	window.Tracker = { track: function (c, a, l, v) { reports.push({category: c, action: a, label: l, value: v}) } }
	
	t.test('check for existence', function (t)
	{
		t.ok(Oops, 'global Oops object')
	})
	
	t.test('simple exception handling', function (t)
	{
		var was
		function error ()
		{
			Oops.enable()
			was = reports.length
			
			blablabla
		}
		setTimeout(error, 10)
		
		function check ()
		{
			t.eq(reports.length, was + 1, 'got one report')
		}
		t.async(check, 50)
	})
	
	t.test('log() and error()', function (t)
	{
		Oops.log('logging')
		var report = reports[reports.length-1]
		t.eq(report.category, 'Oops')
		t.eq(report.action, 'log')
		t.eq(report.label, 'logging')
		
		Oops.error('erroring')
		var report = reports[reports.length-1]
		t.eq(report.category, 'Oops')
		t.eq(report.action, 'error')
		t.eq(report.label, 'erroring')
		
		Oops.time('timing', 12345)
		var report = reports[reports.length-1]
		t.eq(report.category, 'Oops')
		t.eq(report.action, 'time')
		t.eq(report.label, 'timing')
		t.eq(report.value, 12345)
	})
	
	t.test('maybeEnable', function (t)
	{
		Oops.disable()
		t.no(Oops.enabled, 'disabled')
		
		
		t.log('clearing Oops cookie')
		document.cookie = 'Oops=; expires=Sun, 28 Feb 2010 16:53:02 GMT'
		
		Oops.maybeEnable()
		t.ok(Oops.enabled, 'Oops is enabled')
		
		Oops.disable()
		t.no(Oops.enabled, 'disabled')
		
		
		t.log('setting Oops=disabled cookie')
		document.cookie = 'Oops=disabled'
		
		Oops.maybeEnable()
		t.no(Oops.enabled, 'Oops is still disabled')
		
		t.log('force enable Oops')
		Oops.enable()
		t.ok(Oops.enabled, 'Oops is now enabled')
		
		
		Oops.disable()
		t.no(Oops.enabled, 'disabled')
		
		t.log('clearing Oops cookie')
		document.cookie = 'Oops=; expires=Sun, 28 Feb 2010 16:53:02 GMT'
	})
})
</script>
</body>
</html>