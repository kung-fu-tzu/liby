<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=320"/>
	<title>Array randomization tests</title>
	<script src="/lib/tests/tests.common.js" type="text/javascript"></script>
	
	<script src="../../core/prototype.js" type="text/javascript"></script>
</head>
<body>
<script type="text/javascript">
Tests.test(function (t)
{
	Array.prototype.randomize = function ()
	{
		for (var v, i = 0, il = this.length; i < il; i++)
		{
			var j = (Math.random() * il) >> 0
			v = this[j]
			this[j] = this[i]
			this[i] = v
			// t.log(j)
		}
		
		return this
	}
	
	function factorial (n) { return n <= 1 ? 1 : n * factorial(n - 1) }
	
	t.test('distribution and combinations', function (t)
	{
		var arr = [1, 2, 3, 4, 5], combos = {}, count = 100000
		for (var i = 0; i < count; i++)
		{
			var key = arr.slice().randomize().join(', ')
			if (key in combos)
				combos[key]++
			else
				combos[key] = 1
		}
		log(combos)
		var total = factorial(arr.length)
		
		var normal = 0, rounded = (1 / total * 100 >> 0) / 100
		for (var k in combos)
			if ((combos[k] / count * 100) / 100 >= rounded)
				normal++
			else
			{
				t.log((combos[k] / count * 100) / 100, rounded)
			}
		
		t.eq(Object.keys(combos).length, total, 'total')
		t.eq(normal, total, 'normal')
	})
	
	t.test('edge cases', function (t)
	{
		t.eqo([].randomize(), [], 'empty')
		t.eqo([1].randomize(), [1], 'single')
		t.eqo([1, 2].randomize().sort(), [1, 2], 'duo')
		t.eqo([1, 2, "3", "abc", 4.0, [], {}].randomize().sort(), [1, 2, "3", "abc", 4.0, [], {}].sort(), 'different values')
	})
	
})
</script>
</body>
</html>