<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
	<link rel="stylesheet" href="tests.css" type="text/css"/>
	<title>Event classes tests</title>
</head>
<body>

<!--[if lte IE 7]><script type="text/javascript" src="../programica/fixes/trident3.js"></script><![endif]-->
<!--[if IE 8]><script type="text/javascript" src="../programica/trident4.js"></script><![endif]-->
<script type="text/javascript" src="../programica/fixes/log.js"></script>
<script type="text/javascript" src="../programica/init.js"></script>
<script type="text/javascript" src="../programica/prototype.js"></script>
<script type="text/javascript" src="../modules/url-encode.js"></script>

<script type="text/javascript" src="tests.js"></script>
<script type="text/javascript">
	window.addEventListener('load', function () {
	tests.plan(29)
	
	tests.eq(typeof self.encodeURIComponent, 'function', 'encodeURIComponent is a function')
	tests.eq(typeof self.decodeURIComponent, 'function', 'decodeURIComponent is a function')
	tests.eq(encodeURIComponent('abcxyz+x x123890x-x=x&x;x(x)x.x'), 'abcxyz%2Bx%20x123890x-x%3Dx%26x%3Bx(x)x.x', 'encodeURIComponent(...)')
	tests.eq(decodeURIComponent('abcxyz%2Bx%20x123890x-x%3Dx%26x%3Bx(x)x.x'), 'abcxyz+x x123890x-x=x&x;x(x)x.x', 'decodeURIComponent(...)')
	
	tests.eq(encodeURIComponent('xаxбxвxэxюxяxёxйx'), 'x%D0%B0x%D0%B1x%D0%B2x%D1%8Dx%D1%8Ex%D1%8Fx%D1%91x%D0%B9x', 'encodeURIComponent(unicode)')
	tests.eq(decodeURIComponent('x%D0%B0x%D0%B1x%D0%B2x%D1%8Dx%D1%8Ex%D1%8Fx%D1%91x%D0%B9x'), 'xаxбxвxэxюxяxёxйx', 'decodeURIComponent(unicode)')
	
	tests.log('simple')
	tests.eq(UrlEncode.stringify(' '), '%20', '" "')
	tests.eq(UrlEncode.stringify(' = '), '%20%3D%20', '" = "')
	tests.eq(UrlEncode.stringify(123), '123', '123')
	tests.eq(UrlEncode.stringify(null), '', 'null')
	tests.eq(UrlEncode.stringify(undefined), '', 'undefined')
	
	tests.log('stringify array')
	tests.eq(UrlEncode.stringify([123, 456, 789]), '123&456&789', '[123, 456, 789] with default pd="&"')
	UrlEncode.paramDelimiter = ';'
	tests.eq(UrlEncode.stringify([123, 456, 789]), '123;456;789', '[123, 456, 789] with pd=";"')
	tests.eq(UrlEncode.stringify(['abc', 'def', 'ghi']), 'abc;def;ghi', '["abc", "def", "ghi"]')
	tests.eq(UrlEncode.stringify([0, '', undefined, null, false, true]), '0;;undefined;null;false;true', '[0, "", undefined, null, false, true]')
	tests.eq(UrlEncode.stringify(['а', 'б', 'в']), '%D0%B0;%D0%B1;%D0%B2', '["а", "б", "в"]')
	
	tests.log('stringify hash')
	tests.eq(UrlEncode.stringify({a:1, b:2, c:3}), 'a=1;b=2;c=3', '{a:1, b:2, c:3}')
	tests.eq(UrlEncode.stringify({a:1, b:2, c:[3,4]}), 'a=1;b=2;c=3;c=4', '{a:1, b:2, c:[3,4]}')
	tests.eq(UrlEncode.stringify({a:{b:2}}), 'a=%5Bobject%5D', '{a:{b:2}}')
	tests.eq(UrlEncode.stringify({а:'б'}), '%D0%B0=%D0%B1', '{а:"б"}')
	
	tests.log('parse array')
	UrlEncode.paramDelimiter = '&'
	tests.eqo(UrlEncode.parse('123&456&789'), {'123':'', '456':'', '789':''}, '[123, 456, 789] with pd="&"')
	UrlEncode.paramDelimiter = ';'
	tests.eqo(UrlEncode.parse('123;456;789'), {'123':'', '456':'', '789':''}, '[123, 456, 789] with pd=";"')
	tests.eqo(UrlEncode.parse('abc;def;ghi'), {'abc':'', 'def':'', 'ghi':''}, '["abc", "def", "ghi"]')
	tests.eqo(UrlEncode.parse('0;;undefined;null;false;true'), {'0':'', '':'', 'undefined':'', 'null':'', 'false':'', 'true':''}, '["0", "", "undefined", "null", "false", "true"]')
	tests.eqo(UrlEncode.parse('%D0%B0;%D0%B1;%D0%B2'), {'а':'', 'б':'', 'в':''}, '["а", "б", "в"]')
	
	tests.log('parse hash')
	tests.eqo(UrlEncode.parse('a=1;b=2;c=3'), {a:'1', b:'2', c:'3'}, '{a:1, b:2, c:3}')
	tests.eqo(UrlEncode.parse('a=1;b=2;c=3;c=4'), {a:'1', b:'2', c:['3','4']}, 'a=1;b=2;c=3;c=4')
	tests.eqo(UrlEncode.parse('a=%5Bobject%5D'), {a:'[object]'}, 'a=%5Bobject%5D')
	tests.eqo(UrlEncode.parse('%D0%B0=%D0%B1'), {а:'б'}, '%D0%B0=%D0%B1')
	
	
	tests.done()
	}, false)
</script>
</body>
</html>
