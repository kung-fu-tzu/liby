<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Тесты канвы</title>
	<script type="text/javascript" src="/lib/Programica.js"></script>
	<style>
		canvas { border: 1px solid #eee; margin-top: 10px; display: block; cursor: default;/*width: 500px; height: 150px;*/ }
		/*canvas { -webkit-transform: rotate(3deg); cursor: pointer; }*/
	</style>
</head>
<body>
	<hr>
	<p>
		createRadialGradient() + translate() + fillRect()
		<canvas id="createRadialGradient" width="1000" height="300"></canvas>
	</p>
	
	<p>
		rotate() + arc()
		<canvas id="drawSixCycles" width="1000" height="300"></canvas>
	</p>
	
	<script>
	
	var docdoc = document.documentElement
	
	function createRadialGradient ()
	{
		var can = $('createRadialGradient')
		var ctx = can.getContext("2d");
		//log(ctx)
		
		  // Create gradients
		var radgrad = ctx.createRadialGradient(45,45,10,52,50,30);
		radgrad.addColorStop(0, '#A7D30C');
		radgrad.addColorStop(0.9, '#019F62');
		radgrad.addColorStop(1, 'rgba(1,159,98,0)');
		
		var radgrad2 = ctx.createRadialGradient(55,55,20,62,60,50);
		radgrad2.addColorStop(0, '#FF5F98');
		radgrad2.addColorStop(0.75, '#FF0188');
		radgrad2.addColorStop(1, 'rgba(255,1,136,0)');
		
		var i = 0;
		//ctx.translate(45, 45);
		//ctx.rotate(45 * Math.PI / 180);
		var can_x = can.offsetLeft
		var can_y = can.offsetTop
		
		ctx.fillStyle = "rgb(0,0,0)"
		ctx.clearRect(0, 0, 1000, 300)
		ctx.fillRect(0, 0, 1000, 300)
		ctx.globalAlpha = 0.02
		
		var x = 200, y = 100, on = false, timer = null
		
		function move (e)
		{
			//log(e)
			//ctx.clearRect(0, 0, 1000, 300)
			
			x = e.clientX - can_x - 30
			y = e.clientY - can_y - 25
			
		}
		
		function draw ()
		{
			
			ctx.fillRect(0, 0, 1000, 300)
			
			
			if (on)
			{
				ctx.save()
				ctx.translate(x-32,y-30)
				
				ctx.globalAlpha = 1.0
				
				ctx.fillStyle = radgrad2
				ctx.fillRect(0, 0, 200, 200)
				
				ctx.restore()
			}
		}
		
		on = true
		draw()
		on = false
		
		can.addEventListener('mouseover', function () { clearInterval(timer); timer = setInterval(draw, 20) }, false)
		can.addEventListener('mouseout', function () { clearInterval(timer) }, false)
		can.addEventListener('mousedown', function (e) { document.addEventListener('mousemove', move, false); on = true; move(e) }, false)
		document.addEventListener('mouseup', function () { document.removeEventListener('mousemove', move, false); on = false }, false)
	}
	
	function drawSixCycles()
	{
		var can = $('drawSixCycles')
		
		var can_x = can.offsetLeft
		var can_y = can.offsetTop
		
		var ctx = can.getContext('2d')
		var g = 0
		
		//ctx.globalCompositeOperation = 'lighter'
		ctx.fillStyle = "rgb(0,0,0)"
		ctx.clearRect(0, 0, 1000, 300)
		ctx.fillRect(0, 0, 1000, 300)
		ctx.globalAlpha = 0.02
		
		var x = 200, y = 100, on = false, timer = null
		
		function move (e)
		{
			x = e.clientX - can_x - 30
			y = e.clientY - can_y - 25
		}
		
		function draw ()
		{
			ctx.fillRect(0, 0, 1000, 300)
			
			if (on)
			{
				ctx.save()	
				ctx.translate(x, y)
				ctx.rotate(Math.PI * g++ / 180)
				
				ctx.globalAlpha = 1.0
				
				for (var i = 1; i < 6; i++)
				{ // Loop through rings (from inside to out)
					ctx.save()
					ctx.fillStyle = 'rgb('+(51 * i)+','+(255 - 51 * i)+',255)';
					
					for (j = 0; j < i * 6; j++)
					{ // draw individual dots
						ctx.rotate(Math.PI * 2 / (i * 6))
						ctx.beginPath()
						ctx.arc(0, i * 12.5, 5, 0, Math.PI * 2, true)
						ctx.fill()
					}
					
					ctx.restore()
				}
				
				ctx.restore()
			}
		}
		
		on = true
		draw()
		on = false
		
		can.addEventListener('mouseover', function () { clearInterval(timer); timer = setInterval(draw, 20) }, false)
		can.addEventListener('mouseout', function () { clearInterval(timer) }, false)
		can.addEventListener('mousedown', function (e) { document.addEventListener('mousemove', move, false); move(e); on = true }, false)
		document.addEventListener('mouseup', function () { document.removeEventListener('mousemove', move, false); on = false }, false)
	}
	
	function loaded ()
	{
		createRadialGradient()
		
		drawSixCycles()
		
		//context.drawImage(image, sx, sy, swidth, sheight, dx, dy, dwidth, dheight)
	}
	
	$.onload(loaded)
	</script>
	
</body>
</html>